<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WebTorrent Video Player ‚Äì Production Ready</title>
  <style>
    /* Responsive VW/VH sizing for perfect scaling */
    #video-container {
      width: 80vw;
      height: 45vw;       /* 16:9 aspect ratio */
      margin: 5vh auto;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    video {
      width: 100%;
      height: 100%;
      border-radius: 2vw;
      box-shadow: 0 0.5vw 1vw rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <div id="video-container"></div>

  <!-- WebTorrent UMD build over HTTPS -->
  <script src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"></script>
  <script>
    // 1Ô∏è‚É£ Verify library loaded
    console.log('üêøÔ∏è  WebTorrent global:', window.WebTorrent);
    if (!window.WebTorrent) {
      console.error('‚ùå WebTorrent did not load. Check your CDN include.');
      throw new Error('Missing WebTorrent library');
    }

    // 2Ô∏è‚É£ Define our reliable WebSocket trackers
    const WS_TRACKERS = [
      'wss://tracker.openwebtorrent.com/announce',
      'wss://tracker.btorrent.xyz/announce',
      'wss://tracker.webtorrent.io/announce',
      // 'wss://tracker.fastcast.nz/announce'  // optional, can re-enable if desired
    ];

    // 3Ô∏è‚É£ Build the magnet URI with our announce list
    const baseMagnet = [
      'magnet:?xt=urn:btih:b008aca7620938ecf588f084c16e910a5e86cb4b',
      'dn=Locked%20%282025%29%20720p%20WEBRip%20x264%202.0%20YTS%20YIFY'
    ].join('&');

    const magnetURI = WS_TRACKERS
      .map(t => `&tr=${encodeURIComponent(t)}`)
      .reduce((uri, tr) => uri + tr, baseMagnet);

    console.log('üîé Adding torrent:', magnetURI);

    // 4Ô∏è‚É£ Instantiate client and add torrent
    const client = new WebTorrent();
    client.add(magnetURI, { announce: WS_TRACKERS }, torrent => {
      console.log('‚úÖ metadata fetched for torrent:', torrent.name);

      // Telemetry events
      torrent.on('wire', wire => console.log('üîó new peer:', wire.remoteAddress || wire.peerId));
      torrent.on('download', bytes => console.log(`‚¨áÔ∏è  downloaded ${bytes} bytes (total: ${torrent.downloaded})`));
      torrent.on('done', () => console.log('üéâ torrent download complete!'));

      // 5Ô∏è‚É£ Locate the MP4 file
      const file = torrent.files.find(f => f.name.endsWith('.mp4'));
      console.log('üîç MP4 file found:', file ? file.name : 'none');

      if (!file) {
        console.error('‚ùå No .mp4 file in that torrent.');
        return;
      }

      // 6Ô∏è‚É£ Create & inject the <video> element
      const video = document.createElement('video');
      video.controls = true;
      video.autoplay = false;
      video.playsInline = true;
      document.getElementById('video-container').appendChild(video);
      console.log('üé¨ <video> element appended, streaming now‚Ä¶');

      // 7Ô∏è‚É£ Stream into the <video>
      file.renderTo(video, err => {
        if (err) console.error('‚ùå renderTo error:', err);
        else console.log('‚úÖ Video is playing ‚Äì enjoy! üé•');
      });
    });

    // Global error handler
    client.on('error', err => console.error('üí• WebTorrent client error:', err));
  </script>
</body>
</html>
